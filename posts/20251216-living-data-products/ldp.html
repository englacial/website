<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Thomas Teisberg and Shane Grigsby">
<meta name="dcterms.date" content="2025-12-16">

<title>Announcing our Living Data Products awardees –  englacial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../images/logo_snowflake.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-960d9d362f81d399278ec3e29b622b37.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- Privacy-friendly analytics by Plausible -->
<script async="" src="https://plausible.io/js/pa-AegmHWgLHcdedZvtA_uM7.js"></script>
<script>
  window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
  plausible.init()
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title"><img src="../../images/logo_snowflake.png" style="max-height: 1.5em;"> englacial</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">projects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="https://github.com/englacial/xopr">
 <span class="dropdown-text">xOPR</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://astera.org/call-for-proposals-living-data-products-for-ice-sheet-models/">
 <span class="dropdown-text">Living Data Products</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../updates.html"> 
<span class="menu-text">updates</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/englacial"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#a-model-ready-living-data-product-built-with-physics-informed-neural-networks-for-greenland-antarctica" id="toc-a-model-ready-living-data-product-built-with-physics-informed-neural-networks-for-greenland-antarctica" class="nav-link active" data-scroll-target="#a-model-ready-living-data-product-built-with-physics-informed-neural-networks-for-greenland-antarctica">A Model-Ready Living Data Product Built with Physics-Informed Neural Networks for Greenland &amp; Antarctica</a></li>
  <li><a href="#topography-module-for-geobridge-geological-boundary-representation-for-ice-dynamics-and-glacial-evolution" id="toc-topography-module-for-geobridge-geological-boundary-representation-for-ice-dynamics-and-glacial-evolution" class="nav-link" data-scroll-target="#topography-module-for-geobridge-geological-boundary-representation-for-ice-dynamics-and-glacial-evolution">Topography Module for GeoBRIDGE: Geological Boundary Representation for Ice Dynamics and Glacial Evolution</a></li>
  <li><a href="#greenland-grounding-line-locations" id="toc-greenland-grounding-line-locations" class="nav-link" data-scroll-target="#greenland-grounding-line-locations">Greenland Grounding Line Locations</a></li>
  <li><a href="#living-ice-temperature-map-for-east-antarctica" id="toc-living-ice-temperature-map-for-east-antarctica" class="nav-link" data-scroll-target="#living-ice-temperature-map-for-east-antarctica">Living Ice Temperature Map for East Antarctica</a></li>
  <li><a href="#a-model-data-scoring-framework-leveraging-observational-data-to-increase-model-skill" id="toc-a-model-data-scoring-framework-leveraging-observational-data-to-increase-model-skill" class="nav-link" data-scroll-target="#a-model-data-scoring-framework-leveraging-observational-data-to-increase-model-skill">A model-data scoring framework: leveraging observational data to increase model skill</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Announcing our Living Data Products awardees</h1>
  <div class="quarto-categories">
    <div class="quarto-category">news</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Thomas Teisberg and Shane Grigsby </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Most observational data goes through many layers of processing and analysis to transform into a model-ready data product. The process of producing these derived data products and analysis products involves an enormous amount of technical and scientific expertise. The incentives of standard scientific publishing reward the first data product release, but fail to recognize the value of continuous updates. This has often led to these crucial data products becoming unmaintained, lagging behind advances in observations, or being difficult for others to reproduce.</p>
<p>Our Living Data Products grants are designed to incentivize and support scientists building data products as software. Our grantees are building software tools that encode the analysis and processing pipelines into reproducible workflows. This enables data products that are dynamically linked back to observational data sources and can easily be updated as new data becomes available.</p>
<p>We’re excited to share the 5 projects we’re funding and the amazing teams behind each project.</p>
<section id="a-model-ready-living-data-product-built-with-physics-informed-neural-networks-for-greenland-antarctica" class="level3">
<h3 class="anchored" data-anchor-id="a-model-ready-living-data-product-built-with-physics-informed-neural-networks-for-greenland-antarctica">A Model-Ready Living Data Product Built with Physics-Informed Neural Networks for Greenland &amp; Antarctica</h3>
<p><em>Cheng Gong / Dartmouth College</em></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Cheng Gong is hiring a postdoc for this project
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is an open post-doc position to work on this project. If you’re interested in applying, you can find more details <a href="https://apply.interfolio.com/177925">on the job posting</a> or email <a href="gong.cheng@dartmouth.edu">Cheng Gong</a> directly.</p>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="pinn.png" class="img-fluid figure-img"></p>
<figcaption>Synthesizing sparse observational data into a self-consistent dataset for model initialization is a laborious process. Physics-informed neural networks offer a way to automatically build physically self-consistent input datasets, unlocking the ability to assimilate more types of data and accelerating the process of bringing new data into ice sheet models.</figcaption>
</figure>
</div>
<p><strong>Observational input:</strong> Ice surface velocity, ICESat-2 altimetry, radar-derived thickness picks, and surface mass balance reanalysis products</p>
<p><strong>Living data product:</strong> A model-ready, physically self-consistent mesh-free initialization product for ice sheet models</p>
<p><strong>Impact on models:</strong> Modelers are slow to adopt new observational data products in part because getting the observations onto the same grid and making them physically-consistent requires labor-intensive manual processes. This work aims to change that by using a physics-informed neural network (PINN) to ingest observational data and produce physically-consistent, mesh-free estimates of the starting state of each ice sheet. These mesh-free estimates can then be sampled directly onto individual model grids, accelerating the process of bringing new observations into models.</p>
<p><strong>Learn more:</strong> This project is building upon the PINNICLE package. Follow along with the development on <a href="https://github.com/ISSMteam/PINNICLE">GitHub</a>.</p>
</section>
<section id="topography-module-for-geobridge-geological-boundary-representation-for-ice-dynamics-and-glacial-evolution" class="level3">
<h3 class="anchored" data-anchor-id="topography-module-for-geobridge-geological-boundary-representation-for-ice-dynamics-and-glacial-evolution">Topography Module for GeoBRIDGE: Geological Boundary Representation for Ice Dynamics and Glacial Evolution</h3>
<p><em>Emma MacKie, Niya Shao, Michael Field / University of Florida</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="geostatistical-topography.png" class="img-fluid figure-img"></p>
<figcaption>Sparse radar sounder data must be interpolated into a map for use in ice sheet models, but many interpolation techniques produce an unrealistically smooth result. Geostatistical interpolation offers a tool to produce an ensemble of realistically rough bed maps, helping models start from realistic input data that represents the true range of uncertainty.</figcaption>
</figure>
</div>
<p><strong>Observational input:</strong> Radar sounder data, surface velocity, and surface mass balance reanalysis products</p>
<p><strong>Living data product:</strong> An ensemble of plausible realizations of bedrock topography beneath all of Antarctica</p>
<p><strong>Impact on models:</strong> Existing models mostly use one of two bed topography products, neither of which is fully reproducible or able to be sampled to generate multiple realizations. This work will develop a fully reproducible pipeline to generate model-ready bedrock topography products. It will interpolate between radar data points using a mix of physics-based constraints and geostatistical measures of roughness. This approach produces an ensemble of bed realizations, creating a credible interface that describes our uncertainty based on the underlying data.</p>
</section>
<section id="greenland-grounding-line-locations" class="level3">
<h3 class="anchored" data-anchor-id="greenland-grounding-line-locations">Greenland Grounding Line Locations</h3>
<p><em>Leigh A. Stearns and Michael Shahin / University of Pennsylvania</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="grounding-lines.png" class="img-fluid figure-img"></p>
<figcaption>Grounding lines, where the ice flows off of the bedrock and begins to float on the ocean, are typically estimated from satellite data but radar sounders can provide a more precise estimate of where the ice begins to float</figcaption>
</figure>
</div>
<p><strong>Observational input:</strong> Radar sounder data and satellite-derived digital elevation models</p>
<p><strong>Living data product:</strong> Annually-resolved grounding line locations of major Greenland marine-terminating glaciers</p>
<p><strong>Impact on models:</strong> Grounding zones are the regions where the ocean reached under glaciers and starts to float the ice up. Models typically calibrate from the satellite-observed extent of glaciers or the flexure point observed from surface motion. For glaciers that end at the ocean (marine-terminating), this location may be kilometers in front of the actual grounding line and is almost certainly more sensitive to seasonal fluctuations. The melt from this ice-ocean interface is a significant part of the overall mass balance and important to the dynamics, so having a data product that tells us where the grounding line is, not just the terminus, will transform how we calibrate models. This will be the first large-scale data product with radar-derived grounding line location.</p>
</section>
<section id="living-ice-temperature-map-for-east-antarctica" class="level3">
<h3 class="anchored" data-anchor-id="living-ice-temperature-map-for-east-antarctica">Living Ice Temperature Map for East Antarctica</h3>
<p><em>Eliza Dawson, Michael Christoffersen, Donglai Yang, and Winnie Chu / Georgia Tech</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="basal-temperature.png" class="img-fluid figure-img"></p>
<figcaption>Radar sounder attenutation can be used to estimate englacial temperature, a key constraint on ice flow and an area where models currently diverge</figcaption>
</figure>
</div>
<p><strong>Observational input:</strong> Radar sounder data</p>
<p><strong>Living data product:</strong> Map of estimated internal (depth-averaged) temperature within the ice</p>
<p><strong>Impact on models:</strong> Ice sheet models <a href="https://models.englacial.org/app?var=litempbotgr&amp;models=NCAR%2FCISM%2CDOE%2FMALI%2CAWI%2FPISM1%2CLSCE%2FGRISLI2&amp;exps=exp05&amp;cmap=auto&amp;nan=0">diverge widely</a> in their estimates of internal temperature. Prior modelling work from this team has shown that small changes in temperature make a big different in future mass loss, especially in parts of East Antarctica. We currently have no way of measuring temperature beneath the ice without boreholes, so this team’s success will add a major new data-driven constraint to ice sheet models.</p>
</section>
<section id="a-model-data-scoring-framework-leveraging-observational-data-to-increase-model-skill" class="level3">
<h3 class="anchored" data-anchor-id="a-model-data-scoring-framework-leveraging-observational-data-to-increase-model-skill">A model-data scoring framework: leveraging observational data to increase model skill</h3>
<p><em>Anna Ruth (Ruthie) Halberstadt, Sara Peters, and Ginny Catania / University of Texas Austin</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="data-model.png" class="img-fluid figure-img"></p>
<figcaption>Reconstructing historical grounding lines is a useful tool to understand the dynamics of ice sheet retreat</figcaption>
</figure>
</div>
<p>Ruthie’s team is developing model evaluation metrics. It’s not always obvious how data should be compared against models. Models are useful for telling us what our ice sheets will do on medium to long-term scales, not necessarily what they’ll do in a given year. As such, we care more about models being able to reproduce the types of dynamic changes we have seen or believe are possible than we do about them matching, for example, the specific retreat rate in the right year.</p>
<p>This team is developing comparison metrics that are designed to directly ask “are the models getting the dynamics right as we observe them?” rather than “are the models matching the observed data?” For example, you might compare a fast-flowing region by looking at the distribution of observed and modeled surface velocities. This is robust to the model perhaps placing the trunk of the ice stream 10 kilometers off from its actual center.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/englacial\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>