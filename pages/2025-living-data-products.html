<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Living data products for ice sheet models –  englacial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../images/logo_snowflake.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-28ce2f92125236a284ff4f393e5b0d14.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-6.7.2/all.min.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-6.7.2/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<!-- Privacy-friendly analytics by Plausible -->
<script async="" src="https://plausible.io/js/pa-AegmHWgLHcdedZvtA_uM7.js"></script>
<script>
  window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
  plausible.init()
</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title"><img src="../images/logo_snowflake.png" style="max-height: 1.5em;"> englacial</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-models" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">models</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-models">    
        <li>
    <a class="dropdown-item" href="../static/models/">
 <span class="dropdown-text">Viewer</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../models.html">
 <span class="dropdown-text">Examples</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-projects" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">projects</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-projects">    
        <li>
    <a class="dropdown-item" href="https://github.com/englacial/xopr" target="_blank">
 <span class="dropdown-text">xOPR&nbsp;&nbsp;<i class="fa-solid fa-arrow-up-right-from-square" aria-label="arrow-up-right-from-square"></i></span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../pages/2025-living-data-products.html">
 <span class="dropdown-text">Living Data Products</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../updates.html"> 
<span class="menu-text">updates</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/englacial"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#connecting-data-and-models" id="toc-connecting-data-and-models" class="nav-link active" data-scroll-target="#connecting-data-and-models">Connecting data and models</a></li>
  <li><a href="#open-science-objectives" id="toc-open-science-objectives" class="nav-link" data-scroll-target="#open-science-objectives">Open science objectives</a></li>
  <li><a href="#budget" id="toc-budget" class="nav-link" data-scroll-target="#budget">Budget</a></li>
  <li><a href="#other-resources" id="toc-other-resources" class="nav-link" data-scroll-target="#other-resources">Other resources</a></li>
  <li><a href="#proposal-format" id="toc-proposal-format" class="nav-link" data-scroll-target="#proposal-format">Proposal format</a></li>
  <li><a href="#timeline" id="toc-timeline" class="nav-link" data-scroll-target="#timeline">Timeline</a></li>
  <li><a href="#questions" id="toc-questions" class="nav-link" data-scroll-target="#questions">Questions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Living data products for ice sheet models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This call for proposals has now closed. You can read about the <a href="../posts/20251216-living-data-products/ldp.html">selected projects on our blog</a>.</p>
</div>
</div>
<section id="connecting-data-and-models" class="level3">
<h3 class="anchored" data-anchor-id="connecting-data-and-models">Connecting data and models</h3>
<p>Direct comparisons between observational data and ice sheet models are more challenging than they initially appear. Observational data is often sparse, may require domain knowledge to understand it, and comes with variable uncertainties. Because of these challenges, only a limited subset of observational data gets incorporated into ice sheet models.</p>
<p>We believe that connecting observational data to ice sheet models is the key to increasing model skill. Because ice sheets have inherently long time constants, capturing the internal state and boundary processes are especially important to building credibility that models can make accurate predictions into the future.</p>
<p>Examples of topics we are particularly interested in include:</p>
<ul>
<li>Englacial stratigraphy, age-depth models, and other interpretation of internal structure<br>
</li>
<li>Probabilistic interpretations of basal state, such as basal material or temperature<br>
</li>
<li>Surface mass balance and firn structure</li>
</ul>
<p>We are seeking proposals to build model-ready observationally-based living data products relevant to the Antarctic and/or Greenland Ice Sheets. To break down what that means:</p>
<p><strong>Model-ready:</strong> Your work should define a probability function P(m|d) where d represents your data product and m represents a field that is commonly represented by ice sheet models. In other words, we want people to be able to use your work to say “how likely is this ice sheet model output given the observations?”</p>
<p>m could be any variable(s) that you would expect a continent-scale ice sheet model to represent internally. Any variable listed in the ISMIP6 data requests (<a href="https://theghub.org/groups/ismip6/wiki/ISMIP6-Projections2300-Antarctica">Table A1 here</a>) is a good example, but this table is not meant to be an exhaustive list. As long as m consists of variables that are plausible outputs of a physically-based ice sheet model, it’s within the scope of this call.</p>
<p>Data products may be useful at different stages, including set-up, initialization, validation, and comparison. Some data products may be more useful to models that are run over long timescales. The best uses of data products may evolve as models develop, so you do not need to define or anticipate every possible way your data product might be used.</p>
<p><strong>Observationally-based:</strong> The core inputs to your data product should come from existing observational data sources. This may be a single sensing platform/modality or a combination thereof. It may include satellite, airborne, shipborne, and ground-based measurements. We are especially interested in work that incorporates radar sounder data, however proposals using all types of data sources are welcome.</p>
<p><strong>Living data product:</strong> The lag time from data collection to incorporation into models is currently too long. Rather than build a static data product, we are looking for groups to build automated data pipelines that produce data products in ways that can be easily updated as new data becomes available and where the entire workflow is inspectable, reproducible, and extensible by others.</p>
<p>Manual processes, where needed, are still allowed (for example: quality control of input data). However, the results of any manual process should be captured in machine-readable form and it should be possible to automatically re-apply them once they have been manually done once.</p>
</section>
<section id="open-science-objectives" class="level3">
<h3 class="anchored" data-anchor-id="open-science-objectives">Open science objectives</h3>
<p>This is not a standard grant. As described below, <em>how</em> you structure and share your work outputs is as important as the outputs themselves. At the same time, we are offering more than just funding. We will dedicate our own in-house resources to helping you build the best living data product possible. You own 100% of the science. We can help (according to your needs) with data access, software design, automating workflows, and anything else that makes your work accessible, reproducible, and useful. Anticipated compute costs should be included in the budget (see below).</p>
<p>If you are creating a data product relevant to Earth’s ice sheets derived from observational data, this might be a good fit for you. Creators/maintainers of existing data products are also welcome to apply with proposed expansions of the scientific techniques, technical improvements, open science advances, or any combination of these.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">We’re looking for projects that are… <em>(all of these)</em></th>
<th style="text-align: left;">What this means <em>(one possible way to achieve this – but not the only way)</em></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Open-source and built in the open</td>
<td style="text-align: left;">Both the end products and the process should be visible for others so they can learn from and/or extend your work <em>(Actively develop your code in a public git repository, licensed under an MIT License or similar)</em></td>
</tr>
<tr class="even">
<td style="text-align: left;">Dynamically connected to open-source input data sources (if they exist) or easily extensible if such sources don’t yet exist</td>
<td style="text-align: left;">Rather than building a static data product, your project should be adaptable to pull in new data as new observational data becomes available. If QC or other manual processes are required, these processes should be well documented. If programmatic access to the relevant datasets is not yet available, then projects should be designed to easily accept updated data in the future. <em>(Use APIs to access input datasets, allowing for easy updates when new data becomes available)</em></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Automatically reproducible</td>
<td style="text-align: left;">Your entire workflow – from gathering input data to producing outputs – should be easy for another researcher to replicate <em>(A containerized workflow, GitHub Action, runnable notebook or other self-contained piece of code that makes it easy for others to re-run your analysis without going through a complicated multi-step process)</em></td>
</tr>
<tr class="even">
<td style="text-align: left;">Well-documented and citable</td>
<td style="text-align: left;">Your code should be accompanied by high-quality documentation for both downstream users and potential contributors <em>(Include your documentation as part of the code repository and use Zenodo to archive snapshots of the entire repository)</em></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Use and/or extend existing and emerging open science community standards.</td>
<td style="text-align: left;">Your code and data should build on current community efforts and standards, and play well with other open science technology. <em>(Use or extension of existing projects such as xarray, Spacio Temporal Asset Catalogue (STAC), geo{pandas, json, paraquet}, etc.)</em></td>
</tr>
</tbody>
</table>
</section>
<section id="budget" class="level3">
<h3 class="anchored" data-anchor-id="budget">Budget</h3>
<p>You may propose a budget of up to $100,000 for a specific time period of up to 12 months (shorter and/or smaller budget proposals are highly encouraged).</p>
<p>Funding is intended to cover salaries/stipends, computational needs, conference expenses, and any other costs of the project and dissemination of its outputs. Funding will be inline with Astera’s <a href="  https://doi.org/10.5281/zenodo.15548989">Open Science Policy</a>. The goal of the policy is to ensure that science funded by Astera is available to all in a timely manner. The work from this grant should be made available in a timely and open way, and this grant cannot be used for any journal publication fees (including open access fees) or time spent writing for journals. Once the work and underlying data are shared openly, you’re no longer prohibited from future journal publishing.</p>
<p>For any proposed budget over $50,000, the award may be broken into two individual payments, one at the beginning of the project and the other about half way through the proposed period. The second payment may be contingent on reasonable progress in the project.</p>
<p>For university-based research groups, awards will be made in the form of a gift agreement in order to speed the process, with no explicit restrictions on how the funds be used <em>other than that they may not be used to pay journal publishing fees</em>. We expect your budget to reflect the resources you are putting into the project, but we’re not interested in applying bureaucratic restrictions on how you spend your resources.</p>
<p>Astera generally does not pay overhead on gifts. In rare cases where overhead is required, overhead must be included in the budget (i.e., the $100k maximum is inclusive of overhead).</p>
<p>Applications from non-university entities are welcomed. If you’re not based at a university and would like to apply, please reach out to discuss logistics with us and include a basic description of the proposal you’re considering.</p>
</section>
<section id="other-resources" class="level3">
<h3 class="anchored" data-anchor-id="other-resources">Other resources</h3>
<p>In addition to funding, we can provide technical assistance to awardees’ projects. We want to know how we can help you and can devote software engineering resources to accelerating your project. You 100% own your science, but we are here to help with software infrastructure and data management.</p>
<p>Examples of what we can help with:</p>
<ul>
<li>Advice and/or implementation of appropriate data formats<br>
</li>
<li>Technical hurdles to accessing input datasets<br>
</li>
<li>Design of computational and/or data architectures<br>
</li>
<li>Workflow tooling<br>
</li>
<li>Advice on structuring and documenting code</li>
</ul>
<p>We are actively partnering with the Open Polar Radar effort to build improved software tools for accessing radar sounder data, which we anticipate will support some awardees of this grant.</p>
</section>
<section id="proposal-format" class="level3">
<h3 class="anchored" data-anchor-id="proposal-format">Proposal format</h3>
<p>Proposals should be submitted as a single PDF document <a href="https://tally.so/r/wQQdKg">here</a>.</p>
<p>Proposals should include:</p>
<ol type="1">
<li>A project description (up to 2 pages, excluding references) detailing:
<ol type="1">
<li>The living data product you’re building<br>
</li>
<li>What input data sources you intend to use<br>
</li>
<li>What methods you will use or are exploring<br>
</li>
<li>How you envision your outputs being compared against ice sheet model state variable(s)<br>
</li>
<li>(If you are proposing expansion of or modifications to an existing data product:) What already exists and what new contributions will you be adding<br>
</li>
</ol></li>
<li>Brief budget outline describing what financial resources you are requesting and how you anticipate they will be used. Please specify the people that will be funded.<br>
</li>
<li>Project timeline including mid-project milestones for projects longer than 6 months.<br>
</li>
<li>CVs for each person funded by the project. (Not included in the page limit.)</li>
</ol>
<p>Project proposals should not exceed 3 pages, excluding references and CVs.</p>
</section>
<section id="timeline" class="level3">
<h3 class="anchored" data-anchor-id="timeline">Timeline</h3>
<p>Applications are due by 11:59 PM PDT on September 30th, 2025. Decisions will be announced by the end of October.</p>
<p>Proposing teams making it past our first round will be invited to discuss their proposals with us and should expect to have a series of conversations with our team. Feel free to submit ideas that still need a round or two of iteration.</p>
<p>We anticipate making up to 8 awards, depending on the strength of applications and the funding requests. We’re interested in projects with a high impact to resources ratio, so proposals for high-impact projects with shorter timelines or smaller budgets are highly encouraged.</p>
</section>
<section id="questions" class="level3">
<h3 class="anchored" data-anchor-id="questions">Questions</h3>
<p>Any questions about the call for proposals should be sent to <a href="mailto:thomas.teisberg@astera.org">thomas.teisberg@astera.org</a></p>
<p>Frequently asked questions and their answers will be added to this page.</p>
<p>Apply here: <strong>Applications have now closed.</strong></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/englacial\.org");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>